{% extends "base.html" %}

{% block content %}
<h1>Trade Closed{% if close_reason == 'tp_hit' %} - Take Profit Hit!{% elif close_reason == 'sl_hit' %} - Stop Loss Hit{% endif %}</h1>

<p class="lead">Hi {{ name }},</p>

{% if close_reason == 'tp_hit' %}
<p>Congratulations! Your trade hit the take profit target and has been closed with a profit.</p>
{% elif close_reason == 'sl_hit' %}
<p>Your trade hit the stop loss and has been closed to protect your capital.</p>
{% elif close_reason == 'manual' %}
<p>Your trade has been manually closed.</p>
{% elif close_reason == 'liquidation' %}
<p>Your trade has been liquidated due to margin requirements.</p>
{% else %}
<p>Your trade has been closed.</p>
{% endif %}

<div class="info-box {% if pnl >= 0 %}success{% else %}danger{% endif %}">
    <div class="info-box-title">Trade Summary</div>
    <div style="margin-top: 12px;">
        <table style="width: 100%;">
            <tr>
                <td style="padding: 8px 0; color: #6b7280;">Symbol:</td>
                <td style="padding: 8px 0; font-weight: 700; color: #111827; text-align: right; font-size: 18px;">{{ symbol }}</td>
            </tr>
            <tr>
                <td style="padding: 8px 0; color: #6b7280;">Direction:</td>
                <td style="padding: 8px 0; font-weight: 600; text-align: right; color: {% if direction == 'long' %}#10b981{% else %}#ef4444{% endif %};">{{ direction | upper }}</td>
            </tr>
            <tr>
                <td style="padding: 8px 0; color: #6b7280;">Close Reason:</td>
                <td style="padding: 8px 0; font-weight: 600; color: #111827; text-align: right;">{{ close_reason | replace('_', ' ') | title }}</td>
            </tr>
        </table>
    </div>
</div>

<div class="stats-grid">
    <div class="stats-row">
        <div class="stat-item">
            <div class="stat-label">Entry Price</div>
            <div class="stat-value">${{ entry_price }}</div>
        </div>
        <div class="stat-item">
            <div class="stat-label">Exit Price</div>
            <div class="stat-value">${{ exit_price }}</div>
        </div>
    </div>
</div>

<div class="info-box {% if pnl >= 0 %}success{% else %}danger{% endif %}" style="text-align: center;">
    <div class="info-box-title">Realized P&L</div>
    <div style="font-size: 32px; font-weight: 700; color: {% if pnl >= 0 %}#10b981{% else %}#ef4444{% endif %}; margin-top: 8px;">
        {% if pnl >= 0 %}+{% endif %}${{ pnl }}
    </div>
    <div style="font-size: 16px; color: {% if pnl >= 0 %}#059669{% else %}#dc2626{% endif %}; margin-top: 4px;">
        {% if pnl_percent >= 0 %}+{% endif %}{{ pnl_percent }}%
    </div>
</div>

<div class="info-box">
    <div class="info-box-title">Trade Statistics</div>
    <div style="margin-top: 12px;">
        <table style="width: 100%;">
            <tr>
                <td style="padding: 6px 0; color: #6b7280;">Position Size:</td>
                <td style="padding: 6px 0; color: #111827; text-align: right;">${{ position_size_usd }}</td>
            </tr>
            <tr>
                <td style="padding: 6px 0; color: #6b7280;">Leverage:</td>
                <td style="padding: 6px 0; color: #111827; text-align: right;">{{ leverage }}x</td>
            </tr>
            <tr>
                <td style="padding: 6px 0; color: #6b7280;">Fees Paid:</td>
                <td style="padding: 6px 0; color: #111827; text-align: right;">${{ fees_paid }}</td>
            </tr>
            <tr>
                <td style="padding: 6px 0; color: #6b7280;">Duration:</td>
                <td style="padding: 6px 0; color: #111827; text-align: right;">{{ duration }}</td>
            </tr>
        </table>
    </div>
</div>

<div class="button-container">
    <a href="https://stackalpha.xyz/trades/{{ trade_id }}" class="button">View Trade Details</a>
</div>

<div class="divider"></div>

<p>View your complete trading history and performance analytics in your dashboard.</p>

<p>Happy trading,<br><strong>The StackAlpha Team</strong></p>
{% endblock %}
